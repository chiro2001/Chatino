# Chatino FrontEnd

### 前后端数据接口

- start
```
<-{"cmd": "start", "args": {"username": "chiro"}}
->{"code": 0, "message": "Success.", "data": {"username": "lance", "token": "f3b4a7ef196a0030300c545d371c418c", "user": null}}
```

- join
```
<-{"cmd": "join", "args": {"room": "my_room"}}
->{"code": 0, "message": "Success."}
```

- chat
```
<-{"cmd": "chat", "args": {"room": "my_room", "text": "TEXT"}}
->{"code": 0, "message": "Success."}
```

- whisper
```
<-{"cmd": "whisper", "args": {"room": "my_room", "text": "TEXT", "target": "lance"}}
->{"code": 0, "message": "Success."}
```

- exit
```
<-{"cmd": "exit", "args": {}}
```

*基本原则*
- 命令按照顺序解析，上一条命令没有执行完成不会执行下一步
- 都会有返回值，命令和返回值一定是一一对应（exit命令没有返回值）

### 技术难点

*本地数据储存*
- 使用IndexedDB方案，利于兼容Mongodb的NoSQL结构。
- 数据库结构应该和MongoDB的一样

*Vue打包为Android App和桌面应用Electron*
- [参考](https://www.jianshu.com/p/30d44d929468)

### 页面设计

*基本分区*（**暂时参照QQ进行设计**）
- 左边是抽屉页面，右边是浏览页面
- 点击房间进入聊天页面
- 浏览页面是房间列表和操作列表
- 响应式布局，如果页面过宽就把抽屉直接作为div放在左边

*页面管理*：使用vue-router
- vue-router和vue-link
- 在main.js的配置
- 重定向问题
- 直接访问url问题

*抽屉页面*
- 用户信息
- 操作功能
- 快捷功能和浏览功能

*浏览页面*
- 房间
    - 名字
    - 最后发言（本地记录）
    - 时间（注意格式）
    - 消息提醒（小红点）
    - 标记（是否为特别关注的房间）
    - 在线人数（0人关房，即不在内存中）
- 私聊房间（同房间）
    - 名字为"username1|username2"，显示"和usernamex的私聊房间"
    - 没有在线人数显示
    - 检测到房间信息中多于2人的时候，显示"和usernamex等的群组房间"，并且显示人数
    - username不能带的字符增加了啊

*聊天页面*
- 大致界面
    - 返回键、标题栏（同QQ）、操作菜单
    - 信息显示
        - 头像
            - 未注册的人的头像使用占位图，或者根据username生成图像
            - 已经注册的人支持自定义头像
            - 头像的尺寸和规格的改造
        - 用户名
            - 这里的颜色是相对白色主题而言
            - 匿名访问是普通灰色字体
            - 注册用户是普通黑色
            - 机器人是加粗灰色
            - 管理员是加粗红色
            - 网站所有者是加粗黄色
            - 被封禁用户是绿色加粗
            - 自己看自己的颜色是加粗紫色
        - 标识
            - 用户类型用颜色和字体注明
            - 标识码浅色跟在用户名旁边
        - 气泡
            - 文字用带尾部的文字气泡
            - 图片和视频用和文字气泡一样轮廓的气泡（但是是略缩图），没有尾部
            - 文件...
            - 音乐...
        - 输入部分
            - 输入框
                - 使用标准的textarea，支持多行输入
                - Ctrl+回车发送（可以设置）
            - 表情按钮
                - 点击打开表情列表
                - 表情列表有表情包
                    - 我的收藏
                    - 增加我的表情包
                        - 颜文字
                        - 图片库
                - 表情分为图片和颜文字
                    - 颜文字插入光标
                    - 图片立刻发送
            - 发送按钮
            - 加号
                - 和发送不能同时出现，而且二者要一样宽
                - 功能
                    - 发送图片、视频
                    - 发送文件
                    - 发送音乐
                    - 发送涂鸦
        - 菜单
            - 房间信息
            - 私聊给...
            - 查看聊天记录
            - 退出房间
        - 动态效果
            - 新消息插入，底部升高，左右两侧进入
            - 下拉加载，有小圆圈和语录（语录可以成员提交）
            - 加载完毕和插入信息一样
            - 在消息插入中有新的消息，则
                - 提前结束当前动画过程
                - 接续动画过程，营造惯性感